//------------------------------------------------------------------------------
//<auto-generated>
//    This code was generated from a template.
//    Manual changes to this file will be overwritten if the code is regenerated.
//</auto-generated>
//------------------------------------------------------------------------------

function detailHistoryDialog(el) {
    var data = $(el).data('detail');
    $('.clear').val('');
    $('#md-DetailHistory').modal('show');
    console.log("Data History", data);
    $('#DetailHistory-NamaProgram').val(data.Penawaran.Program.NamaProgram);
    $('#DetailHistory-JenisProgram').val(data.Penawaran.Program.JenisProgram.Nama);
    $('#DetailHistory-tgl').val(DateToStringFormat(data.Penawaran.Program.TglPelaksanaan));
    $('#DetailHistory-Tempat').val(data.Penawaran.Program.Kecamatan + "," + data.Penawaran.Program.Kelurahan );
    $('#DetailHistory-Deskripsi').val(data.Penawaran.Program.Deskripsi);
    $('#DetailHistory-DeskripsiPenawaran').val(data.Penawaran.Deskripsi);
    data.Penawaran.Program.Items.forEach(function (list) {
        $('#tbody-KebutuhanDetailHistory').append(`
            <tr>
				<td class="text-center">${list.Nama}</td>
				<td class="text-center">${list.Jumlah}</td>								
                <td class="text-center">${list.SatuanJenis.Nama}</td>
           </tr>
        `)
    })  
    $('#DetailHistory-Comment').val(data.Comment);
    $('#History-previewDokumenPenawaran').text(data.Penawaran.Lampiran[0].Filename)
    $('#History-previewDokumenPenawaran').click(function () {
        GetFilePenawaran(idlampiranpenawaran);
    })
    $('#History-LampiranProgram').html("");
    data.Penawaran.Program.Lampiran.forEach(function (Lampiran) {
        $('#History-LampiranProgram').append(`
                    <div class="card col-4 mx-1">
                        <h4 onclick="GetFileProgramHistory('${Lampiran.Id}')" class="card-title text-truncate">${Lampiran.Filename} <i class="fa fa-download"></i></h4>
                    </div>
                `)
    })
    ///*    Lampiran Penawaran*/
    //data.Penawaran.Lampiran.forEach(function (listLampiran) {
    //    if (listLampiran.Id != null) {
    //        GetFilePenawaranHistory(listLampiran.Id);
    //        $('#History-previewDokumenPenawaran').removeClass('display-none');
    //    }
    //    else {
    //        $('#History-previewDokumenPenawaran').addClass('display-none');
    //    }
    //});
}
function GetFileProgramHistory(Id) {

    RequestData('GET', `/v1/Media/download/${Id}`, '', null, null, function (data_obj) {
        if (data_obj.Succeeded) {
            $('#History-LampiranProgram').text(data_obj.Data.Filename, 'data:application/pdf;base64,' + data_obj.Data.Base64);
        }
        else if (data_obj.code == 401) { //unathorized
            AlertMessage(data_obj.message);
        } else
            ShowNotif(`${data_obj.message} : ${data_obj.description}`, "error");
    });
}
function GetFilePenawaranHistory(Id) {
    RequestData('GET', `/v1/Media/download/${Id}`, '', null, null, function (data_obj) {
        if (data_obj.Succeeded) {
            $('#History-LampiranPenawaran').text(data_obj.Data.Filename, 'data:application/pdf;base64,' + data_obj.Data.Base64);
        }
        else if (data_obj.code == 401) { //unathorized
            AlertMessage(data_obj.message);
        } else
            ShowNotif(`${data_obj.message} : ${data_obj.description}`, "error");
    });
}


function GetFilePenawaran(Id) {
    if (Id == "") {
        AlertMessage("Lampiran Not Found");
    }
    else {
        console.log();
        RequestData('GET', `/v1/Media/download/${Id}`, '', null, null, function (data_obj) {
            if (data_obj.Succeeded) {
                Base64ToFile(data_obj.Data.Filename, "application/octet-stream", data_obj.Data.Base64);
                /*            $('#Detail-LampiranPenawaran').attr(data_obj.Data.Filename, 'data:application/pdf;base64,' + data_obj.Data.Base64);*/
            }
            else if (data_obj.code == 401) { //unathorized
                AlertMessage(data_obj.message);
            } else
                ShowNotif(`${data_obj.message} : ${data_obj.description}`, "error");
        });
    }

}
function GetFileProgramHistory(Id) {
    console.log(Id);
    if (Id == "") {
        AlertMessage("Lampiran Not Found");
    } else {
        RequestData('GET', `/v1/Media/download/${Id}`, '', null, null, function (data_obj) {
            if (data_obj.Succeeded) {
                Base64ToFile(data_obj.Data.Filename, "application/octet-stream", data_obj.Data.Base64);
                /*            $('#Detail-LampiranProgram').text(data_obj.Data.Filename, 'data:application/pdf;base64,' + data_obj.Data.Base64);*/
            }
            else if (data_obj.code == 401) { //unathorized
                AlertMessage(data_obj.message);
            } else
                ShowNotif(`${data_obj.message} : ${data_obj.description}`, "error");
        });
    }

}
